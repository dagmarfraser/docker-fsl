# Dockerfile to make "docker-fsl" with FSLeyes GUI support
# FSL 6.0.6.5
# Based on K. Nemoto's work (05 Feb 2023)
# Modified by D. S. Fraser (18th July 2024)

FROM ubuntu:20.04

ENV DEBIAN_FRONTEND=noninteractive

# General setup
RUN rm /bin/sh && ln -s /bin/bash /bin/sh

# Install utilities, python, and dependencies for GUI applications
RUN apt-get update && apt-get install -y --no-install-recommends \
    bc \
    less \
    libgl1-mesa-dev \
    nano \
    sudo \
    vim \
    wget \
    python3 \
    python3-pip \
    libgtk-3-0 \
    libdbus-glib-1-2 \
    libx11-xcb1 \
    libxt6 \
    libxcomposite1 \
    libxcursor1 \
    libxdamage1 \
    libxext6 \
    libxfixes3 \
    libxi6 \
    libxrandr2 \
    libxrender1 \
    libxtst6 \
    libxss1 \
    libasound2 \
    && rm -rf /var/lib/apt/lists/*

# FSL Installation
RUN cd /tmp && \
    wget http://www.lin4neuro.net/lin4neuro/neuroimaging_software_packages/fsl-6.0.6.5.tar.gz && \
    cd /usr/local && \
    tar xvzf /tmp/fsl-6.0.6.5.tar.gz && \
    rm -rf /usr/local/fsl/src && \
    rm /tmp/fsl-6.0.6.5.tar.gz

# Set FSL environment variables
ENV FSLDIR=/usr/local/fsl
ENV PATH=${FSLDIR}/share/fsl/bin:${PATH}
ENV FSLOUTPUTTYPE=NIFTI_GZ
ENV FSLTCLSH=$FSLDIR/bin/fsltclsh
ENV FSLWISH=$FSLDIR/bin/fslwish

# Install additional Python packages required by FSLeyes
RUN pip3 install --no-cache-dir wxPython==4.0.7 matplotlib

# Create user 'brain'
ARG UID=1000
RUN useradd -m -u ${UID} brain && \
    echo "brain:lin4neuro" | chpasswd && \
    adduser brain sudo

USER brain
ENV USER=brain

# Set the working directory
WORKDIR /home/brain

# Set the entrypoint to bash
ENTRYPOINT ["/bin/bash"]
